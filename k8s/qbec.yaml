apiVersion: qbec.io/v1alpha1
kind: App
metadata:
  name: lab
spec:
  clusterScopedLists: true
  environments:
    lab:
      server: https://lab.home:6443
  vars: 
    topLevel:
    - name: bootstrap
      components: ['vault']


    external:
    - name: workDir
      default: '/Users/ericz/Documents/work'
    computed:
    - name: importTLS
      code: |
        {
          command: './scripts/import-tls.sh',
          args: [ std.extVar('workDir') ]
        }
    - name: importSSH
      code: |
        {
          command: './scripts/import-ssh.sh',
          args: [ std.extVar('workDir') ]
        }
    - name: expandHelm
      code: |
        {
          command: './scripts/expand-helm.sh',
          args: [ std.thisFile ],
          inheritEnv: true,
        }

  dataSources:
  - exec://import-tls?configVar=importTLS
  - exec://import-ssh?configVar=importSSH
  - exec://expand-helm?configVar=expandHelm
